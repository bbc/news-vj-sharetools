define("lib/template_engine",[],function(){var e={},t=function n(t,r){var i=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||n(document.getElementById(t).innerHTML);return r?i(r):i};return t}),define("ShareToolsView",["lib/template_engine"],function(e){var t=function(e){this.networks=e.networkNames,this.template=e.config.template,this.label=e.config.label,this.holderEl=e.config.holderEl;if(!this.template)throw new Error("ShareTools: Template markup was not supplied");this.render()};return t.prototype={render:function(){var t={label:this.label,networks:this.networks},n=e(this.template,t),r=document.querySelector(this.holderEl);r&&(r.innerHTML=n)},getHolderElement:function(){return this.holderEl}},t}),define("ShareToolsModel",[],function(){var e=function(){};return e.prototype={setShareUrl:function(e){this.shareUrl=e||"http://www.bbc.co.uk"},getShareUrl:function(){return this.shareUrl},setMessage:function(e){this.validate&&this.validate(e),this.message=e},getMessage:function(){return this.message}},e}),define("models/Email",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e||!e.subject||!e.message)throw new Error('ShareTools: Email message requires a "subject" and a "message"')},t.prototype.shareEndpoint="mailto:",t.prototype.popup=!1,t.prototype.parameters=function(){return{subject:this.getMessage().subject,body:this.getMessage().message+" "+this.getShareUrl()}},t}),define("models/Facebook",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e||!e.title)throw new Error('ShareTools: Facebook message requires a "title"');e.description=e.description||"Shared via BBC News",e.image=e.image||"http://www.bbc.co.uk/news/special/2015/newsspec_10857/bbc_news_logo.png"},t.prototype.shareEndpoint="https://www.facebook.com/dialog/feed",t.prototype.popup=!0,t.prototype.parameters=function(){return{app_id:"58567469885",redirect_uri:"http://www.bbc.co.uk/news/special/shared/vj_sharetools/fb_red_uri.html?st_cb=facebook#state=feed",display:"popup",locale:"en_GB",link:this.getShareUrl(),name:this.getMessage().title,description:this.getMessage().description,picture:this.getMessage().image}},t}),define("models/Twitter",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e)throw new Error("ShareTools: Twitter message must be set")},t.prototype.shareEndpoint="https://twitter.com/intent/tweet",t.prototype.popup=!0,t.prototype.parameters=function(){return{text:this.getMessage()+" "+this.getShareUrl()}},t}),define("ShareToolsModelFactory",["ShareToolsModel","models/Email","models/Facebook","models/Twitter"],function(e,t,n,r){var i={email:t,facebook:n,twitter:r},s={};return{setMessages:function(e){if(Object.keys(s).length===0)this.initialiseModels(e);else{var t,n;for(n in e)e.hasOwnProperty(n)&&(t=e[n],s[n]||this.initialiseModel(n,t),s[n].setMessage(t))}},setShareUrl:function(e){var t,n;for(t in s)s.hasOwnProperty(t)&&(n=s[t],n.setShareUrl(e))},initialiseModels:function(e){for(var t in e)this.initialiseModel(t,e[t])},initialiseModel:function(e,t){var n;i[e]||(i[e]=this.defineCustomNetwork(e,t)),n=new i[e],n.setMessage(t),s[e]=n},defineCustomNetwork:function(t,n){var r=function(){};r.prototype=Object.create(e.prototype),r.prototype.popup=n.popup===!0,r.prototype.shareEndpoint=n.shareEndpoint;if(!n.shareEndpoint)throw new Error('ShareTools: no shareEndpoint property supplied for custom network "'+t+'"');var i={};for(var s in n.properties)n.properties.hasOwnProperty(s)&&(i[s]=n.properties[s]);return r.prototype.parameters=function(){return i},r},getNetworkConfig:function(e){return s[e]}}}),define("ShareTools",["ShareToolsView","ShareToolsModelFactory"],function(e,t){var n=function(t){this.options=t,this.view=new e({networkNames:this.getNetworkNames(),config:t}),this.setMessages(this.options.messages),this.setShareUrl(this.options.shareUrl),this.setElSelectors(),this.addListeners()};return n.prototype={setMessages:function(e){t.setMessages(e)},setShareUrl:function(e){t.setShareUrl(e)},openShareWindow:function(e){var n=this.getShareTargetUrl(e),r=t.getNetworkConfig(e);r.popup?window.open(n,"_blank","width=626,height=235"):window.location.href=n},getShareTargetUrl:function(e){var n=t.getNetworkConfig(e),r=n.parameters(),i=this.buildQueryStringFrom(r);return n.shareEndpoint+i},buildQueryStringFrom:function(e){var t="?";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+=n+"="+encodeURIComponent(r)+"&"}return t.slice(0,-1)},getNetworkNames:function(){var e=[];for(var t in this.options.messages)this.options.messages.hasOwnProperty(t)&&e.push(t);return e},setElSelectors:function(){var e=this.view.getHolderElement();this.shareButton=document.querySelector(e+" .share__button"),this.toggleOverlay=document.querySelector(e+" .share__overlay"),this.closeButton=document.querySelector(e+" .share__overlay-close"),this.networks=document.querySelectorAll(e+" .share__tool--network")},addListeners:function(){var e=this;this.shareButton&&this.toggleOverlay&&(this.shareButton.addEventListener("click",function(){e.toggleShareOverlay()}),this.closeButton.addEventListener("click",function(){e.toggleShareOverlay()}));if(this.networks)for(var t=0;t<this.networks.length;t++)this.networks[t].addEventListener("click",function(t){e.networkClicked(t)})},toggleShareOverlay:function(){this.toggleOverlay&&(this.toggleOverlay.style.display=this.toggleOverlay.style.display==="block"?"none":"block")},networkClicked:function(e){var t=e.target.getAttribute("data-network");return this.openShareWindow(t),this.toggleShareOverlay(),!1}},n});