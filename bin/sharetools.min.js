define("ShareToolsView",["template_engine"],function(e){var t=function(e){if(this.networks=e.networkNames,this.template=e.config.template,this.label=e.config.label,this.holderEl=e.config.holderEl,!this.template)throw new Error("ShareTools: Template markup was not supplied");this.render()};return t.prototype={render:function(){var t={label:this.label,networks:this.networks},o=e(this.template,t);this.holderEl&&(this.holderEl.innerHTML=o)},getHolderElement:function(){return this.holderEl}},t}),define("ShareToolsModel",[],function(){console.warn("Sharetools no longer supported");var e=function(){};return e.prototype={setShareUrl:function(e){this.shareUrl=e||"https://www.bbc.co.uk"},getShareUrl:function(){return this.shareUrl},setMessage:function(e){this.validate&&(e=this.validate(e)),this.message=e},getMessage:function(){return this.message}},e}),define("models/Email",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e||!e.subject||!e.message)throw new Error('ShareTools: Email message requires a "subject" and a "message"');return e},t.prototype.shareEndpoint="mailto:",t.prototype.popup=!1,t.prototype.parameters=function(){return{subject:this.getMessage().subject,body:this.getMessage().message+" "+this.getShareUrl()}},t}),define("models/Facebook",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e)throw new Error("ShareTools: Facebook message must be set");return e.share_or_feed=e.share_or_feed||"feed",this.shareEndpoint="https://www.facebook.com/dialog/"+e.share_or_feed,e},t.prototype.popup=!0,t.prototype.parameters=function(){return{app_id:"58567469885",redirect_uri:"https://www.bbc.co.uk/news/special/shared/vj_sharetools/fb_red_uri.html?st_cb=facebook#state=feed",display:"popup",locale:"en_GB",link:this.getShareUrl(),quote:this.getMessage().title}},t}),define("models/Twitter",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e)throw new Error("ShareTools: Twitter message must be set");return e},t.prototype.shareEndpoint="https://twitter.com/intent/tweet",t.prototype.popup=!0,t.prototype.parameters=function(){return{text:this.getMessage()+" "+this.getShareUrl()}},t}),define("models/Messenger",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){return e},t.prototype.shareEndpoint="fb-messenger://share",t.prototype.popup=!1,t.prototype.parameters=function(){return{app_id:"58567469885",redirect_uri:"https://www.bbc.co.uk/news/special/shared/vj_sharetools/fb_red_uri.html?st_cb=facebook#state=feed",display:"popup",locale:"en_GB",link:this.getShareUrl()}},t}),define("models/MessengerDesktop",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e)throw new Error("ShareTools: MessengerDesktop message must be set");return e},t.prototype.shareEndpoint="https://www.facebook.com/dialog/feed",t.prototype.popup=!0,t.prototype.parameters=function(){return{app_id:"58567469885",redirect_uri:"https://www.bbc.co.uk/news/special/shared/vj_sharetools/fb_red_uri.html?st_cb=facebook#state=feed",display:"popup",locale:"en_GB",link:this.getShareUrl(),text:this.getMessage().title}},t}),define("models/Whatsapp",["ShareToolsModel"],function(e){var t=function(){};return t.prototype=Object.create(e.prototype),t.prototype.validate=function(e){if(!e)throw new Error("ShareTools: Whatsapp message must be set");return e.title=e.title||"",e},t.prototype.shareEndpoint="whatsapp://send",t.prototype.popup=!1,t.prototype.parameters=function(){return{text:this.getMessage().title+" - "+this.getShareUrl()}},t}),define("ShareToolsModelFactory",["ShareToolsModel","models/Email","models/Facebook","models/Twitter","models/Messenger","models/MessengerDesktop","models/Whatsapp"],function(e,t,o,r,s,n,i){function a(){this.knownModels={email:t,facebook:o,twitter:r,messenger:s,messenger_desktop:n,whatsapp:i},this.modelObjects={}}return a.prototype={setMessages:function(e){if(0===Object.keys(this.modelObjects).length)this.initialiseModels(e);else{var t,o;for(o in e)e.hasOwnProperty(o)&&(t=e[o],this.modelObjects[o]||this.initialiseModel(o,t),this.modelObjects[o].setMessage(t))}},setShareUrl:function(e){var t,o;for(t in this.modelObjects)this.modelObjects.hasOwnProperty(t)&&(o=this.modelObjects[t],o.setShareUrl(e))},initialiseModels:function(e){for(var t in e)this.initialiseModel(t,e[t])},initialiseModel:function(e,t){var o,r;this.knownModels[e]||(this.knownModels[e]=this.defineCustomNetwork(e,t)),o=this.knownModels[e],r=new o,r.setMessage(t),this.modelObjects[e]=r},defineCustomNetwork:function(t,o){var r=function(){};if(r.prototype=Object.create(e.prototype),r.prototype.popup=!0===o.popup,r.prototype.shareEndpoint=o.shareEndpoint,!o.shareEndpoint)throw new Error('ShareTools: no shareEndpoint property supplied for custom network "'+t+'"');return r.prototype.parameters=function(){var e={};for(var t in o.properties)o.properties.hasOwnProperty(t)&&(e[t]=o.properties[t]);return e},r},getNetworkConfig:function(e){return this.modelObjects[e]}},a}),define("ShareTools",["ShareToolsView","ShareToolsModelFactory"],function(e,t){var o=function(o){this.options=o,this.factory=new t,this.view=new e({networkNames:this.getNetworkNames(),config:o}),this.shareButtonCallbacks=[],this.setMessages(this.options.messages),this.setShareUrl(this.options.shareUrl),this.setElSelectors(),this.changeUrls(),this.addListeners()};return o.prototype={setMessages:function(e){this.factory.setMessages(e)},setShareUrl:function(e){this.factory.setShareUrl(e)},openShareWindow:function(e){var t=navigator.userAgent.match(/^cucumber$/i),o=this.getShareTargetUrl(e),r=this.factory.getNetworkConfig(e);if(t)window.locations_visited=window.locations_visited||[],window.locations_visited.push(o);else{if(!r.popup)return!0;var s=window.open(o,"_blank","width=626,height=235");s.opener=null,s.location=o}},getShareTargetUrl:function(e){var t=this.factory.getNetworkConfig(e);if(!t)throw new Error("Could not find network config for network "+e);var o=t.parameters(),r=this.buildQueryStringFrom(o);return t.shareEndpoint+r},buildQueryStringFrom:function(e){var t="?";for(var o in e)if(e.hasOwnProperty(o)){var r=e[o];t+=o+"="+encodeURIComponent(r)+"&"}return t.slice(0,-1)},getNetworkNames:function(){var e=[];for(var t in this.options.messages)this.options.messages.hasOwnProperty(t)&&e.push(t);return e},setElSelectors:function(){var e=this.view.getHolderElement();this.shareButton=e.querySelector(".share__button"),this.toggleOverlay=e.querySelector(".share__overlay"),this.closeButton=e.querySelector(".share__overlay-close"),this.networks=e.querySelectorAll(".share__tool--network")},addListeners:function(){var e=this;if(this.shareButton&&this.toggleOverlay&&(this.shareButton.addEventListener("click",function(t){return t.preventDefault(),e.toggleShareOverlay(),!1}),this.closeButton.addEventListener("click",function(t){return t.preventDefault(),e.toggleShareOverlay(),!1})),this.networks)for(var t=0;t<this.networks.length;t++)this.networks[t].addEventListener("click",function(t){e.networkClicked(t)})},changeUrls:function(){for(var e=0;e<this.networks.length;e++){var t=this.networks[e].getAttribute("data-network");!0!==this.factory.getNetworkConfig(t).popup&&(this.networks[e].href=this.getShareTargetUrl(t),-1===this.networks[e].href.indexOf("mailto")&&(this.networks[e].rel="noopener"))}},toggleShareOverlay:function(){this.toggleOverlay&&(this.toggleOverlay.style.display="block"===this.toggleOverlay.style.display?"none":"block")},onShareButtonClick:function(e){this.shareButtonCallbacks.push(e)},resolveShareButtonCallbacks:function(e){for(var t=0;t<this.shareButtonCallbacks.length;t++){(0,this.shareButtonCallbacks[t])(e)}},networkClicked:function(e){var t=e.currentTarget.getAttribute("data-network");return!0===this.factory.getNetworkConfig(t).popup?(e.preventDefault(),this.openShareWindow(t),this.toggleShareOverlay(),this.resolveShareButtonCallbacks(t),!1):(this.toggleShareOverlay(),this.resolveShareButtonCallbacks(t),!0)}},o});