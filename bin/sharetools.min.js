define("ShareToolsModel",[],function(){var e=function(){};return e.prototype={setShareUrl:function(e){this.shareUrl=e||"http://www.bbc.co.uk"},getShareUrl:function(){return this.shareUrl},setFacebookMessage:function(e){if(!e||!e.title)throw new Error('ShareTools: Facebook message requires a "title"');e.description=e.description||"Shared via BBC News",e.image=e.image||"http://www.bbc.co.uk/news/special/2015/newsspec_10857/bbc_news_logo.png",this.facebookMessage=e},getFacebookMessage:function(){return this.facebookMessage},setTwitterMessage:function(e){if(!e)throw new Error("ShareTools: Twitter message must be set");this.twitterMessage=e},getTwitterMessage:function(){return this.twitterMessage},setEmailMessage:function(e){if(!e||!e.subject||!e.message)throw new Error('ShareTools: Email message requires a "subject" and a "message`"');this.emailMessage=e},getEmailMessage:function(){return this.emailMessage},setAppMessage:function(e){if(!e||!e.title||!e.text)throw new Error('ShareTools: App message requires a "title" and a "text`"');this.appMessage=e},getAppMessage:function(){return this.appMessage}},e}),define("lib/template_engine",[],function(){var e={},t=function n(t,r){var i=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||n(document.getElementById(t).innerHTML);return r?i(r):i};return t}),define("ShareToolsView",["bootstrap","lib/template_engine"],function(e,t){var n=function(e){var t=this;this.controller=e.controller,this.model=e.model,this.config=e.config,this.template=this.getTemplate(),this.label=e.config.label,this.isInTheNewsApp=e.config.isInTheNewsApp,this.$holderEl=e.config.holderEl;if(!this.template)throw new Error("ShareTools: Template ("+e.template+") not found");this.render(),this.setElSelectors(),this.addListeners()};return n.prototype={render:function(){var n={label:this.label,isInTheNewsApp:this.isInTheNewsApp,networks:this.controller.getNetworkNames()},r=t(this.template,n);this.$el=e.$(r),this.$holderEl.empty(),this.$holderEl.append(this.$el)},getTemplate:function(){var e;if(this.config.template&&this.config.templateMarkup)throw new Error("ShareTools: You cannot set a template and templateMarkup, please remove one");return this.isInTheNewsApp?e='<div class="share ns__share-dropdown">                                <div class="share__button">                                    <div class="share__png_icon"></div>                                    <p><%= label %></p>                                    </div>                                </div>                            </div>':this.config.templateMarkup?e=this.config.templateMarkup:this.config.template&&(e=""),e},setElSelectors:function(){this.$shareButton=this.$el.find(".share__button"),this.$toggleOverlay=this.$el.find(".share__overlay"),this.$closeButton=this.$el.find(".share__overlay-close"),this.$networks=this.$el.find(".share__tool--network")},addListeners:function(){this.$shareButton&&this.$toggleOverlay&&(this.$shareButton.on("click",this.toggleShareOverlay.bind(this)),this.$closeButton.on("click",this.toggleShareOverlay.bind(this))),this.$networks.on("click",this.networkClicked.bind(this))},toggleShareOverlay:function(){this.isInTheNewsApp?this.controller.openNewsAppShare():this.$toggleOverlay.toggle()},networkClicked:function(t){var n=e.$(t.currentTarget).data("network");return this.controller.openShareWindow(n),this.$toggleOverlay.toggle(),!1}},n}),define("ShareToolsNetworkConfig",[],function(){return function(e){return[{name:"facebook",shareEndpoint:"https://www.facebook.com/dialog/feed",popup:!0,staticParameters:{app_id:"58567469885",redirect_uri:"http://www.bbc.co.uk/news/special/shared/vj_sharetools/fb_red_uri.html?st_cb=facebook#state=feed",display:"popup",locale:"en_GB"},dynamicParameters:{link:function(){return e.model.getShareUrl()},name:function(){return e.model.getFacebookMessage().title},description:function(){return e.model.getFacebookMessage().description},picture:function(){return e.model.getFacebookMessage().image}}},{name:"twitter",shareEndpoint:"https://twitter.com/intent/tweet",popup:!0,dynamicParameters:{text:function(){return e.model.getTwitterMessage()+" "+e.model.getShareUrl()}}},{name:"email",shareEndpoint:"mailto:",popup:!1,dynamicParameters:{subject:function(){return e.model.getEmailMessage().subject},body:function(){return e.model.getEmailMessage().message+" "+e.model.getShareUrl()}}}]}}),define("lib/bind.polyfill",[],function(){Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i})}),define("ShareTools",["bootstrap","ShareToolsModel","ShareToolsView","ShareToolsNetworkConfig","lib/bind.polyfill"],function(e,t,n,r){var i=function(e){this.options=e,this.model=new t,this.view=new n({model:this.model,controller:this,config:e}),this.init()};return i.prototype={init:function(){this.setMessages(this.options.messages),this.setShareUrl(this.options.shareUrl)},setShareUrl:function(e){this.model.setShareUrl(e)},setMessages:function(e){this.model.setFacebookMessage(e.facebook),this.model.setTwitterMessage(e.twitter),this.model.setEmailMessage(e.email),this.model.setAppMessage(e.app)},openShareWindow:function(e){var t=this.getShareTargetUrl(e),n=this.getNetworkConfig(e);n.popup?window.open(t,"_blank","width=626,height=235"):window.location.href=t},getShareTargetUrl:function(e){var t=this.getNetworkConfig(e),n=this.getNetworkParameters(t),r=this.buildQueryStringFrom(n);return t.shareEndpoint+r},buildQueryStringFrom:function(e){var t="?";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+=n+"="+encodeURIComponent(r)+"&"}return t.slice(0,-1)},getNetworkParameters:function(e){var t=e.staticParameters||{};for(var n in e.dynamicParameters)e.dynamicParameters.hasOwnProperty(n)&&(t[n]=e.dynamicParameters[n]());return t},getNetworkConfigList:function(){return r(this)},getNetworkConfig:function(e){var t=this.getNetworkConfigList();for(var n=0;n<t.length;n++){var r=t[n];if(r.name===e)return r}return null},getNetworkNames:function(){var e=this.getNetworkConfigList(),t=[];for(var n=0;n<e.length;n++)t.push(e[n].name);return t},openNewsAppShare:function(){var t=this.model.getAppMessage();e.pubsub.emit("app-share",[t])}},i});