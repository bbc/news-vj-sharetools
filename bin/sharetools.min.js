define("ShareToolsModel",[],function(){var e=function(){};return e.prototype={setMessages:function(e){this.setFacebookMessage(e.facebook),this.setTwitterMessage(e.twitter),this.setEmailMessage(e.email)},setShareUrl:function(e){this.shareUrl=e||"http://www.bbc.co.uk"},getShareUrl:function(){return this.shareUrl},setFacebookMessage:function(e){if(!e||!e.title)throw new Error('ShareTools: Facebook message requires a "title"');e.description=e.description||"Shared via BBC News",e.image=e.image||"http://www.bbc.co.uk/news/special/2015/newsspec_10857/bbc_news_logo.png",this.facebookMessage=e},getFacebookMessage:function(){return this.facebookMessage},setTwitterMessage:function(e){if(!e)throw new Error("ShareTools: Twitter message must be set");this.twitterMessage=e},getTwitterMessage:function(){return this.twitterMessage},setEmailMessage:function(e){if(!e||!e.subject||!e.message)throw new Error('ShareTools: Email message requires a "subject" and a "message"');this.emailMessage=e},getEmailMessage:function(){return this.emailMessage}},e}),define("lib/template_engine",[],function(){var e={},t=function n(t,r){var i=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||n(document.getElementById(t).innerHTML);return r?i(r):i};return t}),define("ShareToolsView",["jquery","lib/template_engine"],function(e,t){var n=function(e){var t=this;this.controller=e.controller,this.model=e.model,this.config=e.config,this.template=e.config.template,this.label=e.config.label,this.$holderEl=e.config.holderEl;if(!this.template)throw new Error("ShareTools: Template not found");this.render(),this.setElSelectors(),this.addListeners()};return n.prototype={render:function(){var n={label:this.label,networks:this.controller.getNetworkNames()},r=t(this.template,n);this.$el=e(r),this.$holderEl.empty(),this.$holderEl.append(this.$el)},setElSelectors:function(){this.$shareButton=this.$el.find(".share__button"),this.$toggleOverlay=this.$el.find(".share__overlay"),this.$closeButton=this.$el.find(".share__overlay-close"),this.$networks=this.$el.find(".share__tool--network")},addListeners:function(){var e=this;this.$shareButton&&this.$toggleOverlay&&(this.$shareButton.on("click",function(){e.toggleShareOverlay()}),this.$closeButton.on("click",function(){e.toggleShareOverlay()})),this.$networks.on("click",function(t){e.networkClicked(t)})},toggleShareOverlay:function(){this.$toggleOverlay&&this.$toggleOverlay.toggle()},networkClicked:function(t){var n=e(t.currentTarget).data("network");return this.controller.openShareWindow(n),this.toggleShareOverlay(),!1}},n}),define("ShareToolsNetworkConfig",[],function(){return function(e){return[{name:"facebook",shareEndpoint:"https://www.facebook.com/dialog/feed",popup:!0,staticParameters:{app_id:"58567469885",redirect_uri:"http://www.bbc.co.uk/news/special/shared/vj_sharetools/fb_red_uri.html?st_cb=facebook#state=feed",display:"popup",locale:"en_GB"},dynamicParameters:{link:function(){return e.model.getShareUrl()},name:function(){return e.model.getFacebookMessage().title},description:function(){return e.model.getFacebookMessage().description},picture:function(){return e.model.getFacebookMessage().image}}},{name:"twitter",shareEndpoint:"https://twitter.com/intent/tweet",popup:!0,dynamicParameters:{text:function(){return e.model.getTwitterMessage()+" "+e.model.getShareUrl()}}},{name:"email",shareEndpoint:"mailto:",popup:!1,dynamicParameters:{subject:function(){return e.model.getEmailMessage().subject},body:function(){return e.model.getEmailMessage().message+" "+e.model.getShareUrl()}}}]}}),define("ShareTools",["jquery","ShareToolsModel","ShareToolsView","ShareToolsNetworkConfig"],function(e,t,n,r){var i=function(e){this.options=e,this.model=new t,this.view=new n({model:this.model,controller:this,config:e}),this.init()};return i.prototype={init:function(){this.model.setMessages(this.options.messages),this.model.setShareUrl(this.options.shareUrl)},setMessages:function(e){this.model.setMessages(e)},openShareWindow:function(e){var t=this.getShareTargetUrl(e),n=this.getNetworkConfig(e);n.popup?window.open(t,"_blank","width=626,height=235"):window.location.href=t},getShareTargetUrl:function(e){var t=this.getNetworkConfig(e),n=this.getNetworkParameters(t),r=this.buildQueryStringFrom(n);return t.shareEndpoint+r},buildQueryStringFrom:function(e){var t="?";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+=n+"="+encodeURIComponent(r)+"&"}return t.slice(0,-1)},getNetworkParameters:function(e){var t=e.staticParameters||{};for(var n in e.dynamicParameters)e.dynamicParameters.hasOwnProperty(n)&&(t[n]=e.dynamicParameters[n]());return t},getNetworkConfigList:function(){return r(this)},getNetworkConfig:function(e){var t=this.getNetworkConfigList();for(var n=0;n<t.length;n++){var r=t[n];if(r.name===e)return r}return null},getNetworkNames:function(){var e=this.getNetworkConfigList(),t=[];for(var n=0;n<e.length;n++)t.push(e[n].name);return t}},i});